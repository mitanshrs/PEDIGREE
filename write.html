<!DOCTYPE html>
<html>
<head><title>PEDIGREE | WRITE</title><link rel="stylesheet" href="style.css"><link rel="icon" href="logo.png">
<script>
        (function() {
            const s = JSON.parse(localStorage.getItem('db_settings')) || {style:'modern', theme:'blue', appearance:'system'};
            const html = document.documentElement;
            html.classList.add('style-' + s.style);
            html.classList.add('theme-' + s.theme);
            let m = s.appearance;
            if (s.style === 'terminal') m = 'dark';
            else if (m === 'system') m = window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
            html.classList.add('mode-' + m);
        })();
    </script></head>
<body>
     <div class="scanline"></div>
     <nav>
        <div style="flex: 1; display: flex; align-items: center; gap: 1rem; justify-content: center; margin-left: 45px;">
            <img src="logo.png" width="35px" height="35px">
            <a href="index.html">Home</a>
            <a href="write.html" style="text-decoration: underline;">Write</a>
            <a href="read.html">Read</a>
            <a href="list.html">List</a>
            <a href="transfer.html">Sync</a>
        </div>
        <div style="width: 45px; display: flex; justify-content: flex-end;">
            <a href="settings.html" title="Settings" style="padding: 0; font-size: 1.2rem;">⚙️</a>
        </div>
    </nav>

    <div class="container">
        <h1 class="title">PEDIGREE</h1>
        <h1>WRITE TO DATABASE</h1>
        
        <label>SELECT OPERATION</label>
        <select id="mode" onchange="toggleMode()">
            <option value="item">CREATE NEW ITEM BLUEPRINT (12 digits)</option>
            <option value="batch">INITIALIZE BATCH (6 chars)</option>
            <option value="unique">MAKE A UNIQUE IDENTITY (12-6-1)</option>
        </select>

        <div id="blueprint-fields" class="card">
            <label>ITEM ID (12 DIGITS)</label>
            <input type="text" id="id12" placeholder="180030176195">
            <label>ITEM NAME</label>
            <input type="text" id="name" placeholder="OBJECT_ALPHA">
        </div>

        <div id="batch-fields" class="card" style="display:none;">
            <label>BATCH CODE (6 CHARS)</label>
            <input type="text" id="id6" placeholder="BTCH01">
        </div>

        <div id="unique-fields" class="card" style="display:none;">
            <label>UNIT ID (1 DIGIT: 1-9)</label>
            <input type="number" id="id1" min="1" max="9" placeholder="1">
            <label>INITIAL CUSTODIAN</label>
            <input type="text" id="owner" placeholder="USER_01">
            <label>LOCATION</label>
            <input type="text" id="location" placeholder="WAREHOUSE_A">
            <label>DATE & TIME</label>
            <input type="datetime-local" id="datetime">
            <button type="button" onclick="setCurrentDateTime()">USE CURRENT TIME</button>
        </div>

        <button onclick="executeWrite()">SAVE</button>
    </div>

    <script src="logic.js"></script>
    <script>
        function setCurrentDateTime() {
            const now = new Date();
            const year = now.getFullYear();
            const month = String(now.getMonth() + 1).padStart(2, '0');
            const day = String(now.getDate()).padStart(2, '0');
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            document.getElementById('datetime').value = `${year}-${month}-${day}T${hours}:${minutes}`;
        }

        function toggleMode() {
            const m = document.getElementById('mode').value;
            if (m === 'item') {
                document.getElementById('blueprint-fields').style.display = "block";
                document.getElementById('batch-fields').style.display = "none";
                document.getElementById('unique-fields').style.display = "none";
            } else if (m === 'batch') {
                document.getElementById('blueprint-fields').style.display = "none";
                document.getElementById('batch-fields').style.display = "block";
                document.getElementById('unique-fields').style.display = "none";
            } else if (m === 'unique') {
                document.getElementById('blueprint-fields').style.display = "block";
                document.getElementById('batch-fields').style.display = "block";
                document.getElementById('unique-fields').style.display = "block";
            }
        }

        function executeWrite() {
            const mode = document.getElementById('mode').value;
            const i12 = document.getElementById('id12').value;
            
            // 1. Create Blueprint (only for item and unique modes)
            if(mode == 'item' && i12 && !items[i12]) items[i12] = { name: document.getElementById('name').value || "UNNAMED" };

            // 2. Handle Batch/Unique
            if(mode == 'batch') {
                const i6 = document.getElementById('id6').value;
                if(!batches[i6]) batches[i6] = {};
                if(!batches[i6][i12]) batches[i6][i12] = {};
            }
            
            if(mode === 'unique') {
                const i6 = document.getElementById('id6').value;
                if(!batches[i6]) batches[i6] = {};
                if(!batches[i6][i12]) batches[i6][i12] = {};
                
                const i1 = document.getElementById('id1').value;
                if(i1 < 1 || i1 > 9) return alert("UNIT_RANGE_ERROR");
                if(batches[i6][i12][i1]) return alert("IDENTITY_EXISTS");

                const owner = document.getElementById('owner').value;
                const location = document.getElementById('location').value;
                const datetimeValue = document.getElementById('datetime').value;
                const timestamp = datetimeValue ? new Date(datetimeValue).toLocaleString() : new Date().toLocaleString();

                batches[i6][i12][i1] = {
                    current_owner: owner,
                    location: location,
                    history: [{ from: "ORIGIN", to: owner, date: timestamp, location: location }]
                };
            }
            sync(); alert("WRITE_COMPLETE");
        }
    </script>
    <p class="mitansh-ud">By Mitansh Udernani</p>
</body>
</html>
